qiniu = require 'qiniu'
path = require 'path'

qiniu.conf.ACCESS_KEY = "ppt_6Ck2Px_fFlLE125iHU7EP1MPwYQvVJYd0fv9"
qiniu.conf.SECRET_KEY = "1HqcnqgtjEtuPOOJbteNUe34QnPxpaD11kXiDYSj"

BUCKET_NAME = "mofang-statics"
DOMAIN = " http://sts0.mofang.com/"


uploadToQiniu = (filename,content,next)->
    putPolicy = new qiniu.rs.PutPolicy "#{BUCKET_NAME}:#{filename}"
    uptoken = putPolicy.token()
    extra = new qiniu.io.PutExtra();
    if /\.js$/ig.test filename
        extra.mimeType = "application/x-javascript"
    qiniu.io.put uptoken, filename, content, extra,next

removeFile = (filename)->
    client = new qiniu.rs.Client()
    entry = new qiniu.rs.EntryPath BUCKET_NAME,filename
    err,ret = client.batchDelete! [entry]
    console.log err,ret

module.exports.uploadToQiniu = uploadToQiniu
if require.main is module
    filename = "test2.js"
    content = "111con"
    err,ret = uploadToQiniu! filename,content
    console.log err,ret

    # remove file
    # removeFile "test2.js"
